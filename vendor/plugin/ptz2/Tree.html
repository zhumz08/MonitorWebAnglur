<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="./js/jquery-1.9.1.min.js" type="text/javascript"></script>
    <script src="./easyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="./easyui/TreeObject.js" type="text/javascript"></script>
    <link href="./easyui/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="./easyui/themes/icon.css">

    <script type="text/javascript">
        var treeObj = new TreeObject();

        function initTree(){
            $("#realTimeTree").tree({
                data:treeObj.getRootNode(),
                onClick:function(node){
                    if(node.iconCls=='icon-camera-group'){
                        if(node.state=='closed'){
                            $('#realTimeTree').tree('expand',node.target);
                        }else{
                            $('#realTimeTree').tree('collapse',node.target);
                        }
                        return;
                    }
                },
                onDblClick:function(node){
                    playCameraVideo(node);
                }
            });
         }

         function playCameraVideo(node){
             var selectId = (node.id).substring(1,node.id.length);
             if(!window.parent.currCameraId || selectId!=window.parent.currCameraId){
                 window.parent.currCameraId = selectId;
                 window.parent.playCarmVideo(selectId);
             }
         }

         function addCameraXML(cameraXmlDoc){
            treeObj.parseCameraXML(cameraXmlDoc,"realTimeTree");
         }

         function logout(){
             $("#realTimeTree").tree({data:[]});
         }

         function getFind(searchId){
             if(searchId==null||searchId.length==0){
                 $("#realTimeTree").css("display","");
                 $("#selectedTree").css("display","none");
             }else{
                 $("#realTimeTree").css("display","none");

                 var findId = "C" + searchId;
                 var node = $('#realTimeTree').tree('find',findId);
                 if(node==null){
                     return;
                 }
                 var dataArr = $("#realTimeTree").tree('getData',node.target);

                 var dataList = [{
                     id:"test",
                     text:"搜索相机列表",
                     children:[]
                 }];

                 dataList[0].children.push(dataArr);
                 $("#selectedTree").tree({
                     data:dataList,
                     onClick:function(node){
                         playCameraVideo(node);
                     },
                     onDblClick:function(node){
                       playCameraVideo(node);
                     }
                 });
                 $("#selectedTree").css("display","");
             }
         }

       /*
       用于测试的代码，非常重要 **/
       $(function(){

           $.get("http://localhost:63342/MonitorWebAnglur/data/tree_group.xml",null,function(groupXML){
                    treeObj.parseGroupXML(groupXML);
                    initTree();

                $.get("http://localhost:63342/MonitorWebAnglur/data/tree_camera.xml",null,function(cameraXmlDoc){
                        treeObj.parseCameraXML(cameraXmlDoc,"realTimeTree");
                    });
            });

        });

   </script>
</head>
<body>
<div class="easyui-panel" style="border: none;">
    <ul id="selectedTree" style="display: none"></ul>
    <ul class="easyui-tree" id="realTimeTree"  >
    </ul>
</div>
</body>
</html>